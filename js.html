<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />    
    <title>Quiz Javascript</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìú</text></svg>"
    />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      @keyframes shake {
        10%, 90% { transform: translate3d(-1px, 0, 0); }
        20%, 80% { transform: translate3d(2px, 0, 0); }
        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
        40%, 60% { transform: translate3d(4px, 0, 0); }
      }
      .shake {
        animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-4xl">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-indigo-800 mb-2">Quiz Javascript üìú</h1>
        <p class="text-lg text-gray-600">Testez vos connaissances en Javascript</p>
      </div>

      <!-- Quiz Container -->
      <div id="quiz-container" class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <!-- Progress Bar -->
        <div class="mb-6">
          <div class="flex justify-between mb-2">
            <span class="text-sm font-medium text-indigo-700">Progression</span>
            <span
              id="progress-text"
              class="text-sm font-medium text-indigo-700"
            ></span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div
              id="progress-bar"
              class="bg-indigo-600 h-2.5 rounded-full"
              style="width: 20%"
            ></div>
          </div>
        </div>

        <!-- Question Container -->
        <div id="question-container" class="mb-8">
          <!-- Question will be dynamically inserted here -->
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between">
          <button
            id="prev-btn"
            class="flex items-center justify-center px-5 py-2 text-sm text-indigo-700 transition-colors duration-150 bg-indigo-100 rounded-lg hover:bg-indigo-200 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i class="fas fa-arrow-left mr-2"></i> Pr√©c√©dent
          </button>
          <button
            id="next-btn"
            class="flex items-center justify-center px-5 py-2 text-sm text-white transition-colors duration-150 bg-indigo-600 rounded-lg hover:bg-indigo-700"
          >
            Suivant <i class="fas fa-arrow-right ml-2"></i>
          </button>
          <button
            id="results-btn"
            class="hidden flex items-center justify-center px-5 py-2 text-sm text-white transition-colors duration-150 bg-green-600 rounded-lg hover:bg-green-700"
          >
            Voir les r√©sultats <i class="fas fa-chart-bar ml-2"></i>
          </button>
        </div>
      </div>

      <!-- Results Container -->
      <div
        id="results-container"
        class="hidden bg-white rounded-xl shadow-lg p-6"
      >
        <div class="text-center mb-6">
          <h2 class="text-2xl font-bold text-indigo-800 mb-2">
            R√©sultats du Quiz
          </h2>
          <div
            class="inline-flex items-center px-4 py-2 bg-indigo-100 text-indigo-800 rounded-full"
          >
            <i class="fas fa-trophy mr-2"></i>
            <span id="score-text" class="font-bold"
              >Score: 0/quizQuestions.length</span
            >
          </div>
        </div>

        <div id="results-list" class="space-y-4">
          <!-- Results will be dynamically inserted here -->
        </div>

        <div class="mt-8 text-center">
          <button
            id="restart-btn"
            class="px-6 py-3 text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition-colors duration-150"
          >
            <i class="fas fa-redo mr-2"></i> Recommencer le Quiz
          </button>
          <button
            id="download-pdf-btn"
            class="px-6 py-3 text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors duration-150 ml-4"
          >
            <i class="fas fa-download mr-2"></i> T√©l√©charger en PDF
          </button>
        </div>

        <div class="mt-8 text-center">
          <a
            href="index.html"
            class="px-6 py-3 text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition-colors duration-150"
          >
            <i class="fas fa-redo mr-2"></i>Revenir √† la page principale
          </a>
        </div>
      </div>
    </div>

    <script>
      localStorage.clear();
      // Quiz questions data
      const quizQuestions = [
        {
          id: 1,
          type: "multichoix",
          question: "Comment d√©clare-t-on une variable en JavaScript?",
          options: ["var", "let", "const", "Toutes ces r√©ponses"],
          correctAnswer: 3,
          explanation:
            "var, let et const sont utilis√©s pour d√©clarer des variables, mais avec des port√©es et des comportements diff√©rents.",
        },
        {
          id: 2,
          type: "multichoix",
          question:
            "Quelle m√©thode permet d'ajouter un √©l√©ment √† la fin d'un tableau?",
          options: ["push()", "pop()", "shift()", "unshift()"],
          correctAnswer: 0,
          explanation: "push() ajoute un ou plusieurs √©l√©ments √† la fin d'un tableau.",
        },
        {
          id: 3,
          type: "multichoix",
          question: "Comment compare-t-on la valeur ET le type en JavaScript?",
          options: ["==", "===", "!=", "!=="],
          correctAnswer: 1,
          explanation:
            "L'op√©rateur '===' (√©galit√© stricte) compare la valeur et le type, sans conversion de type.",
        },
        {
          id: 4,
          type: "multichoix",
          question: "Comment √©crit-on une fonction fl√©ch√©e?",
          options: [
            "function() => {}",
            "() => {}",
            "=> function() {}",
            "() -> {}",
          ],
          correctAnswer: 1,
          explanation:
            "La syntaxe d'une fonction fl√©ch√©e est (param√®tres) => { corps }.",
        },
        {
          id: 5,
          type: "multichoix",
          question:
            "Quelle m√©thode permet de s√©lectionner un √©l√©ment HTML par son ID?",
          options: [
            "getElementByName()",
            "querySelector()",
            "getElementById()",
            "Les deux derni√®res r√©ponses",
          ],
          correctAnswer: 3,
          explanation:
            "getElementById('id') et querySelector('#id') permettent de s√©lectionner un √©l√©ment par son ID.",
        },
        {
          id: 6,
          type: "multichoix",
          question: "Qu'est-ce qu'une fermeture (closure) en JavaScript?",
          options: [
            "Une fonction qui n'a pas de nom",
            "Une fonction qui se ferme automatiquement apr√®s ex√©cution",
            "Une fonction qui se souvient de son scope lexical, m√™me lorsqu'elle est ex√©cut√©e hors de ce scope",
            "Une fonction qui ne peut √™tre appel√©e qu'une seule fois",
          ],
          correctAnswer: 2,
          explanation:
            "Une fermeture est une fonction qui a acc√®s √† son propre scope, au scope de la fonction externe, et au scope global.",
        },
        {
          id: 7,
          type: "multichoix",
          question: "Quelle est la diff√©rence entre 'null' et 'undefined'?",
          options: [
            "Aucune, ils sont identiques",
            "'undefined' signifie qu'une variable a √©t√© d√©clar√©e mais pas assign√©e, 'null' est une valeur d'assignation",
            "'null' est une erreur, 'undefined' ne l'est pas",
            "'undefined' est un objet, 'null' est un type primitif",
          ],
          correctAnswer: 1,
          explanation:
            "'undefined' est la valeur par d√©faut des variables non initialis√©es. 'null' est une valeur explicite signifiant 'aucune valeur'.",
        },
        {
          id: 8,
          type: "multichoix",
          question:
            "Quelle m√©thode de tableau cr√©e un nouveau tableau avec les r√©sultats de l'appel d'une fonction fournie sur chaque √©l√©ment?",
          options: ["forEach()", "map()", "filter()", "reduce()"],
          correctAnswer: 1,
          explanation:
            "map() cr√©e un nouveau tableau en appliquant une fonction √† chaque √©l√©ment du tableau d'origine.",
        },
        {
          id: 9,
          type: "multichoix",
          question:
            "Comment g√©rez-vous les op√©rations asynchrones en JavaScript moderne?",
          options: ["Callbacks", "Promises", "Async/Await", "Toutes ces r√©ponses"],
          correctAnswer: 3,
          explanation:
            "Les Callbacks sont la m√©thode traditionnelle, mais les Promises et Async/Await sont des approches plus modernes et lisibles pour g√©rer l'asynchronisme.",
        },
        {
          id: 10,
          type: "multichoix",
          question: "Que fait l'op√©rateur '...' (spread operator)?",
          options: [
            "Il additionne tous les √©l√©ments d'un tableau",
            "Il permet d'√©tendre un it√©rable (comme un tableau) l√† o√π des arguments ou des √©l√©ments sont attendus",
            "Il cr√©e une r√©f√©rence √† un autre tableau",
            "Il acc√®de au dernier √©l√©ment d'un tableau",
          ],
          correctAnswer: 1,
          explanation:
            "L'op√©rateur '...' peut √™tre utilis√© pour copier des tableaux, concat√©ner des tableaux, ou passer des √©l√©ments de tableau comme arguments de fonction.",
        },
        {
          id: 11,
          type: "multichoix",
          question: "Qu'est-ce que le 'hoisting' (remont√©e) en JavaScript?",
          options: [
            "Uniquement les d√©clarations de variables avec 'let' sont remont√©es",
            "Le processus o√π l'interpr√©teur semble d√©placer les d√©clarations de variables et de fonctions en haut de leur scope",
            "Une erreur qui se produit lorsque les variables ne sont pas d√©clar√©es",
            "La conversion automatique des types de donn√©es",
          ],
          correctAnswer: 1,
          explanation:
            "En raison du hoisting, les d√©clarations de variables (avec 'var') et de fonctions sont trait√©es avant toute ex√©cution de code.",
        },
        {
          id: 12,
          type: "multichoix",
          question:
            "Quelle m√©thode de tableau v√©rifie si au moins un √©l√©ment du tableau passe le test impl√©ment√© par la fonction fournie?",
          options: ["every()", "some()", "find()", "includes()"],
          correctAnswer: 1,
          explanation:
            "some() retourne 'true' si la fonction de callback retourne 'true' pour au moins un √©l√©ment du tableau; sinon, elle retourne 'false'.",
        },
        {
          id: 13,
          type: "multichoix",
          question: "√Ä quoi sert `JSON.stringify()`?",
          options: [
            "√Ä analyser une cha√Æne JSON pour cr√©er un objet JavaScript",
            "√Ä convertir un objet JavaScript en une cha√Æne JSON",
            "√Ä v√©rifier si une cha√Æne est un JSON valide",
            "√Ä compresser une cha√Æne JSON",
          ],
          correctAnswer: 1,
          explanation:
            "`JSON.stringify()` est utilis√© pour s√©rialiser un objet JavaScript en une cha√Æne de caract√®res au format JSON, souvent pour l'envoyer √† un serveur.",
        },
        {
          id: 14,
          type: "multichoix",
          question: "Comment fonctionne le mot-cl√© `this` dans une fonction fl√©ch√©e?",
          options: [
            "Il se r√©f√®re toujours √† l'objet global 'window'",
            "Il est d√©termin√© par la fa√ßon dont la fonction est appel√©e",
            "Il n'existe pas dans les fonctions fl√©ch√©es",
            "Il conserve la valeur 'this' du contexte lexical qui l'entoure",
          ],
          correctAnswer: 3,
          explanation:
            "Contrairement aux fonctions classiques, les fonctions fl√©ch√©es n'ont pas leur propre contexte 'this'. Elles h√©ritent du 'this' de leur parent.",
        },
        {
          id: 15,
          type: "multichoix",
          question: "Qu'est-ce que la d√©structuration (destructuring) en ES6?",
          options: [
            "Une fa√ßon de d√©truire des objets pour lib√©rer de la m√©moire",
            "Une syntaxe qui permet d'extraire des donn√©es de tableaux ou d'objets dans des variables distinctes",
            "Une m√©thode pour restructurer la base de code",
            "Une erreur de syntaxe",
          ],
          correctAnswer: 1,
          explanation:
            "La d√©structuration rend le code plus propre et plus lisible. Exemple : const { nom, age } = personne;",
        },
        {
          id: 16,
          type: "multichoix",
          question: "√Ä quoi sert la m√©thode `Array.prototype.reduce()`?",
          options: [
            "√Ä r√©duire la taille d'un tableau",
            "√Ä ex√©cuter une fonction 'r√©ducteur' sur chaque √©l√©ment du tableau, r√©sultant en une seule valeur de sortie",
            "√Ä filtrer les √©l√©ments d'un tableau",
            "√Ä cr√©er une copie r√©duite du tableau",
          ],
          correctAnswer: 1,
          explanation:
            "`reduce()` est souvent utilis√© pour calculer la somme des √©l√©ments d'un tableau ou pour 'aplatir' un tableau de tableaux.",
        },
        {
          id: 17,
          type: "multichoix",
          question: "Qu'est-ce qu'une `Promise` (Promesse)?",
          options: [
            "Une garantie que le code s'ex√©cutera sans erreur",
            "Un objet repr√©sentant l'ach√®vement ou l'√©chec √©ventuel d'une op√©ration asynchrone",
            "Une syntaxe pour d√©clarer des fonctions asynchrones",
            "Uniquement une ancienne fa√ßon de g√©rer les callbacks",
          ],
          correctAnswer: 1,
          explanation:
            "Une promesse peut √™tre dans l'un de ces √©tats : en attente (pending), tenue (fulfilled), ou rompue (rejected).",
        },
        {
          id: 18,
          type: "multichoix",
          question: "Comment ajouter un √©l√©ment au d√©but d'un tableau?",
          options: ["push()", "shift()", "unshift()", "pop()"],
          correctAnswer: 2,
          explanation:
            "`unshift()` ajoute un ou plusieurs √©l√©ments au d√©but d'un tableau et renvoie la nouvelle longueur du tableau.",
        },
        {
          id: 19,
          type: "multichoix",
          question: "Quel est le but de `use strict`?",
          options: [
            "Rendre le code plus rapide",
            "Activer un mode strict qui transforme certaines erreurs silencieuses en erreurs explicites",
            "Permettre l'utilisation de fonctionnalit√©s plus r√©centes",
            "Forcer l'utilisation de TypeScript",
          ],
          correctAnswer: 1,
          explanation:
            "Le mode strict aide √† √©crire un code plus s√ªr en pr√©venant ou en lan√ßant des erreurs pour des actions consid√©r√©es comme des mauvaises pratiques.",
        },
        {
          id: 20,
          type: "multichoix",
          question: "Comment peut-on cr√©er un nouvel √©l√©ment HTML en JavaScript?",
          options: [
            "document.newElement('div')",
            "document.create('div')",
            "document.createElement('div')",
            "new HtmlElement('div')",
          ],
          correctAnswer: 2,
          explanation:
            "La m√©thode `document.createElement()` cr√©e l'√©l√©ment HTML sp√©cifi√© par tagName. On peut ensuite l'ajouter au DOM avec `appendChild()`.",
        },
      ];

      document.getElementById("progress-text").textContent =
        "Question 1/" + quizQuestions.length;

      // DOM Elements
      const questionContainer = document.getElementById("question-container");
      const progressBar = document.getElementById("progress-bar");
      const progressText = document.getElementById("progress-text");
      const prevBtn = document.getElementById("prev-btn");
      const nextBtn = document.getElementById("next-btn");
      const resultsBtn = document.getElementById("results-btn");
      const quizContainer = document.getElementById("quiz-container");
      const resultsContainer = document.getElementById("results-container");
      const scoreText = document.getElementById("score-text");
      const resultsList = document.getElementById("results-list");
      const restartBtn = document.getElementById("restart-btn");
      const downloadPdfBtn = document.getElementById("download-pdf-btn");

      // Quiz state
      let currentQuestionIndex = 0;
      let userAnswers =
        JSON.parse(localStorage.getItem("jsQuizAnswers")) ||
        Array(quizQuestions.length).fill(null);

      // Initialize the quiz
      function initQuiz() {
        displayQuestion(currentQuestionIndex);
        updateProgress();
        updateNavigationButtons();
      }

      // Display current question
      function displayQuestion(index) {
        const question = quizQuestions[index];
        let questionHTML = "";

        if (question.type === "vrai-faux") {
          questionHTML = `
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">${
                          question.question
                        }</h3>
                        <div class="flex space-x-4">
                            <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-150 flex-1 ${
                              userAnswers[index] === "vrai"
                                ? "border-indigo-500 bg-indigo-50"
                                : ""
                            }">
                                <input type="radio" name="answer" value="vrai" class="hidden" ${
                                  userAnswers[index] === "vrai" ? "checked" : ""
                                }>
                                <div class="flex items-center justify-center w-6 h-6 border-2 border-gray-300 rounded-full mr-3 ${
                                  userAnswers[index] === "vrai"
                                    ? "border-indigo-500 bg-indigo-500"
                                    : ""
                                }">
                                    ${
                                      userAnswers[index] === "vrai"
                                        ? '<i class="fas fa-check text-white text-xs"></i>'
                                        : ""
                                    }
                                </div>
                                <span class="text-lg">Vrai</span>
                            </label>
                            <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-150 flex-1 ${
                              userAnswers[index] === "faux"
                                ? "border-indigo-500 bg-indigo-50"
                                : ""
                            }">
                                <input type="radio" name="answer" value="faux" class="hidden" ${
                                  userAnswers[index] === "faux" ? "checked" : ""
                                }>
                                <div class="flex items-center justify-center w-6 h-6 border-2 border-gray-300 rounded-full mr-3 ${
                                  userAnswers[index] === "faux"
                                    ? "border-indigo-500 bg-indigo-500"
                                    : ""
                                }">
                                    ${
                                      userAnswers[index] === "faux"
                                        ? '<i class="fas fa-check text-white text-xs"></i>'
                                        : ""
                                    }
                                </div>
                                <span class="text-lg">Faux</span>
                            </label>
                        </div>
                    </div>
                `;
        } else if (question.type === "multichoix") {
          questionHTML = `
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">${
                          question.question
                        }</h3>
                        <div class="space-y-3">
                            ${question.options
                              .map(
                                (option, i) => `
                                <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-150 ${
                                  userAnswers[index] === i
                                    ? "border-indigo-500 bg-indigo-50"
                                    : ""
                                }">
                                    <input type="radio" name="answer" value="${i}" class="hidden" ${
                                  userAnswers[index] === i ? "checked" : ""
                                }>
                                    <div class="flex items-center justify-center w-6 h-6 border-2 border-gray-300 rounded-full mr-3 ${
                                      userAnswers[index] === i
                                        ? "border-indigo-500 bg-indigo-500"
                                        : ""
                                    }">
                                        ${
                                          userAnswers[index] === i
                                            ? '<i class="fas fa-check text-white text-xs"></i>'
                                            : ""
                                        }
                                    </div>
                                    <span class="text-lg">${option}</span>
                                </label>
                            `
                              )
                              .join("")}
                        </div>
                    </div>
                `;
        }

        questionContainer.innerHTML = questionHTML;

        // Add event listeners to answer options
        const answerOptions = questionContainer.querySelectorAll("label");
        answerOptions.forEach((option) => {
          option.addEventListener("click", () => {
            // Remove selection from all options
            answerOptions.forEach((opt) => {
              opt.classList.remove("border-indigo-500", "bg-indigo-50");
              const radio = opt.querySelector('input[type="radio"]');
              const checkIcon = opt.querySelector(".fa-check");
              if (checkIcon) {
                checkIcon.parentElement.classList.remove(
                  "border-indigo-500",
                  "bg-indigo-500"
                );
                checkIcon.remove();
              }
            });

            // Select clicked option
            option.classList.add("border-indigo-500", "bg-indigo-50");
            const radio = option.querySelector('input[type="radio"]');
            radio.checked = true;

            const checkDiv = option.querySelector("div");
            checkDiv.classList.add("border-indigo-500", "bg-indigo-500");
            checkDiv.innerHTML =
              '<i class="fas fa-check text-white text-xs"></i>';

            // Save answer
            saveAnswer(index, radio.value);
          });
        });
      }

      // Save answer to localStorage
      function saveAnswer(index, answer) {
        userAnswers[index] = answer;
        localStorage.setItem("jsQuizAnswers", JSON.stringify(userAnswers));
        updateNavigationButtons();
      }

      // Update progress bar and text
      function updateProgress() {
        const progress =
          ((currentQuestionIndex + 1) / quizQuestions.length) * 100;
        progressBar.style.width = `${progress}%`;
        progressText.textContent = `Question ${currentQuestionIndex + 1}/${
          quizQuestions.length
        }`;
      }

      // Update navigation buttons state
      function updateNavigationButtons() {
        prevBtn.disabled = currentQuestionIndex === 0;

        if (currentQuestionIndex === quizQuestions.length - 1) {
          nextBtn.classList.add("hidden");
          resultsBtn.classList.remove("hidden");
        } else {
          nextBtn.classList.remove("hidden");
          resultsBtn.classList.add("hidden");
        }
      }

      // Show results
      function showResults() {
        let score = 0;
        resultsList.innerHTML = "";

        quizQuestions.forEach((question, index) => {
          const userAnswer = userAnswers[index];
          let isCorrect = false;

          if (question.type === "vrai-faux") {
            isCorrect = userAnswer === question.correctAnswer;
          } else if (question.type === "multichoix") {
            isCorrect = parseInt(userAnswer) === question.correctAnswer;
          }

          if (isCorrect) score++;

          const resultItem = document.createElement("div");
          resultItem.className = `p-4 rounded-lg border ${
            isCorrect
              ? "bg-green-50 border-green-200"
              : "bg-red-50 border-red-200"
          }`;

          let userAnswerText = "";
          if (question.type === "vrai-faux") {
            userAnswerText = userAnswer || "Non r√©pondu";
          } else if (question.type === "multichoix") {
            userAnswerText =
              userAnswer !== null
                ? question.options[userAnswer]
                : "Non r√©pondu";
          }

          resultItem.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mt-1 mr-3">
                            <i class="fas ${
                              isCorrect
                                ? "fa-check-circle text-green-500"
                                : "fa-times-circle text-red-500"
                            }"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">${
                              question.question
                            }</h4>
                            <div class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-2">
                                <div class="${
                                  isCorrect ? "text-green-700" : "text-red-700"
                                }">
                                    <span class="font-medium">Votre r√©ponse:</span> ${
                                      !userAnswerText
                                        ? "vous n'avez pas r√©pondu"
                                        : userAnswerText
                                    }
                                </div>
                                ${
                                  !isCorrect
                                    ? `
                                    <div class="text-green-700">
                                        <span class="font-medium">Bonne r√©ponse:</span> 
                                        ${
                                          question.type === "vrai-faux"
                                            ? question.correctAnswer
                                            : question.options[
                                                question.correctAnswer
                                              ]
                                        }
                                    </div>
                                `
                                    : ""
                                }
                            </div>
                            <div class="mt-2 text-gray-600 text-sm">
                                <i class="fas fa-info-circle mr-1"></i> ${
                                  question.explanation
                                }
                            </div>
                        </div>
                    </div>
                `;

          resultsList.appendChild(resultItem);
        });

        scoreText.textContent = `Score: ${score}/${quizQuestions.length}`;
        quizContainer.classList.add("hidden");
        resultsContainer.classList.remove("hidden");

        const scorePercentage = (score / quizQuestions.length) * 100;

        if (scorePercentage >= 50) {
          // Celebration effect
          confetti({
            particleCount: 200,
            spread: 100,
            origin: { y: 0.6 },
          });
        } else {
          // Failure effect
          resultsContainer.classList.add("shake");
        }
      }

      // Event Listeners
      prevBtn.addEventListener("click", () => {
        if (currentQuestionIndex > 0) {
          currentQuestionIndex--;
          displayQuestion(currentQuestionIndex);
          updateProgress();
          updateNavigationButtons();
        }
      });

      nextBtn.addEventListener("click", () => {
        if (currentQuestionIndex < quizQuestions.length - 1) {
          currentQuestionIndex++;
          displayQuestion(currentQuestionIndex);
          updateProgress();
          updateNavigationButtons();
        }
      });

      resultsBtn.addEventListener("click", showResults);

      restartBtn.addEventListener("click", () => {
        // Clear saved answers
        localStorage.removeItem("jsQuizAnswers");
        userAnswers = Array(quizQuestions.length).fill(null);
        currentQuestionIndex = 0;

        // Reset UI
        resultsContainer.classList.add("hidden");
        quizContainer.classList.remove("hidden");
        resultsContainer.classList.remove("shake"); // Remove shake effect on restart

        // Reinitialize quiz
        initQuiz();
      });

      downloadPdfBtn.addEventListener("click", () => {
        const { jsPDF } = window.jspdf;
        const resultsToCapture = document.getElementById("results-container");

        // Temporarily show the container to capture it, if it's hidden
        const wasHidden = resultsToCapture.classList.contains("hidden");
        if (wasHidden) {
          resultsToCapture.classList.remove("hidden");
        }

        html2canvas(resultsToCapture).then((canvas) => {
          if (wasHidden) {
            resultsToCapture.classList.add("hidden");
          }
          const imgData = canvas.toDataURL("image/png");
          const pdf = new jsPDF("p", "mm", "a4");
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
          pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
          pdf.save("quiz-js-results.pdf");
        });
      });
      // Initialize the quiz
      initQuiz();
    </script>
  </body>
</html>
